Â)
ÉC:\Users\jpedr\Workspace\Fiap\tech-challenges-fiap-pos-dotnet\FiapCloudGames.Infrastructure\Configuration\JwtBearerConfiguration.cs
	namespace 	
FiapCloudGames
 
. 
Infrastructure '
.' (
Configuration( 5
;5 6
public		 
static		 
class		 "
JwtBearerConfiguration		 *
{

 
public 

static 
void 
ConfigureJwtBearer )
() *
this* .
IServiceCollection/ A
servicesB J
,J K
IConfigurationL Z
configuration[ h
)h i
{ 
services 
. 
AddAuthentication 
( 
$str '
)' (
. 
AddJwtBearer 
( 
$str "
," #
options$ +
=>, .
{ 
options 
. 
	Authority !
=" #
configuration$ 1
[1 2
$str2 A
]A B
;B C
options 
. 
Audience  
=! "
configuration# 0
[0 1
$str1 ?
]? @
;@ A
options 
.  
RequireHttpsMetadata ,
=- .
false/ 4
;4 5
options 
. 
Events 
=  
new! $
JwtBearerEvents% 4
{ 
OnChallenge 
=  !
async" '
context( /
=>0 2
{ 
context 
.  
HandleResponse  .
(. /
)/ 0
;0 1
context 
.  
Response  (
.( )

StatusCode) 3
=4 5
StatusCodes6 A
.A B!
Status401UnauthorizedB W
;W X
context 
.  
Response  (
.( )
ContentType) 4
=5 6
$str7 I
;I J
var 
traceId #
=$ %
context& -
.- .
HttpContext. 9
.9 :
Items: ?
[? @
$str@ R
]R S
?S T
.T U
ToStringU ]
(] ^
)^ _
??` b
contextc j
.j k
HttpContextk v
.v w
TraceIdentifier	w Ü
;
Ü á
var 
response $
=% &
new' *
{   
error!! !
=!!" #
$str!!$ 2
,!!2 3

statusCode"" &
=""' (
$num"") ,
,"", -
message## #
=##$ %
$str##& L
,##L M
traceId$$ #
}%% 
;%% 
var'' 
json''  
=''! "
JsonSerializer''# 1
.''1 2
	Serialize''2 ;
(''; <
response''< D
,''D E
new''F I!
JsonSerializerOptions''J _
{((  
PropertyNamingPolicy)) 0
=))1 2
JsonNamingPolicy))3 C
.))C D
	CamelCase))D M
}** 
)** 
;** 
await,, 
context,, %
.,,% &
Response,,& .
.,,. /

WriteAsync,,/ 9
(,,9 :
json,,: >
),,> ?
;,,? @
}-- 
,-- 
OnForbidden.. 
=..  !
async.." '
context..( /
=>..0 2
{// 
context00 
.00  
Response00  (
.00( )

StatusCode00) 3
=004 5
StatusCodes006 A
.00A B
Status403Forbidden00B T
;00T U
context11 
.11  
Response11  (
.11( )
ContentType11) 4
=115 6
$str117 I
;11I J
var33 
traceId33 #
=33$ %
context33& -
.33- .
HttpContext33. 9
.339 :
Items33: ?
[33? @
$str33@ R
]33R S
?33S T
.33T U
ToString33U ]
(33] ^
)33^ _
??33` b
context33c j
.33j k
HttpContext33k v
.33v w
TraceIdentifier	33w Ü
;
33Ü á
var44 
response44 $
=44% &
new44' *
{55 
error66 !
=66" #
$str66$ /
,66/ 0

statusCode77 &
=77' (
$num77) ,
,77, -
message88 #
=88$ %
$str88& Y
,88Y Z
traceId99 #
}:: 
;:: 
var<< 
json<<  
=<<! "
JsonSerializer<<# 1
.<<1 2
	Serialize<<2 ;
(<<; <
response<<< D
,<<D E
new<<F I!
JsonSerializerOptions<<J _
{==  
PropertyNamingPolicy>> 0
=>>1 2
JsonNamingPolicy>>3 C
.>>C D
	CamelCase>>D M
}?? 
)?? 
;?? 
awaitAA 
contextAA %
.AA% &
ResponseAA& .
.AA. /

WriteAsyncAA/ 9
(AA9 :
jsonAA: >
)AA> ?
;AA? @
}BB 
}CC 
;CC 
}DD 
)DD 
;DD 
}EE 
}FF €
|C:\Users\jpedr\Workspace\Fiap\tech-challenges-fiap-pos-dotnet\FiapCloudGames.Infrastructure\Configuration\MongoDbSettings.cs
	namespace 	
FiapCloudGames
 
. 
Infrastructure '
.' (
Configuration( 5
;5 6
public		 
class		 
MongoDbSettings		 
{

 
public 

string 
ConnectionString "
{# $
get% (
;( )
set* -
;- .
}/ 0
=1 2
string3 9
.9 :
Empty: ?
;? @
public 

string 
DatabaseName 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
} ê	
ÅC:\Users\jpedr\Workspace\Fiap\tech-challenges-fiap-pos-dotnet\FiapCloudGames.Infrastructure\Configuration\SerilogConfiguration.cs
	namespace 	
FiapCloudGames
 
. 
Infrastructure '
.' (
Configuration( 5
;5 6
public 
class  
SerilogConfiguration !
{ 
public 

static 
Serilog 
. 
Core 
. 
Logger %
ConfigureSerilog& 6
(6 7
)7 8
{		 
return

 
new

 
LoggerConfiguration

 &
(

& '
)

' (
. 	
MinimumLevel	 
. 
Information !
(! "
)" #
. 	
Enrich	 
. 
FromLogContext 
( 
)  
. 	
WriteTo	 
. 
Console 
( 
outputTemplate 
: 
$str	 Ü
)
Ü á
. 	
CreateLogger	 
( 
) 
; 
} 
} ò
sC:\Users\jpedr\Workspace\Fiap\tech-challenges-fiap-pos-dotnet\FiapCloudGames.Infrastructure\Mappings\GameMapping.cs
	namespace 	
FiapCloudGames
 
. 
Infrastructure '
.' (
Mappings( 0
;0 1
public 
class 
GameMapping 
{ 
public 

static 
void 
	Configure  
(  !
)! "
{ 
if 

( 
! 
BsonClassMap 
.  
IsClassMapRegistered .
(. /
typeof/ 5
(5 6
Game6 :
): ;
); <
)< =
{ 	
BsonClassMap 
. 
RegisterClassMap )
<) *
Game* .
>. /
(/ 0
map0 3
=>4 6
{ 
map 
. 
AutoMap 
( 
) 
; 
map 
. 
MapIdMember 
(  
g  !
=>" $
g% &
.& '
Id' )
)) *
. 
SetSerializer !
(! "
new" %
GuidSerializer& 4
(4 5
GuidRepresentation5 G
.G H
StandardH P
)P Q
)Q R
;R S
map 
. 
	MapMember 
( 
g 
=>  "
g# $
.$ %
Title% *
)* +
.+ ,
SetIsRequired, 9
(9 :
true: >
)> ?
;? @
map 
. 
	MapMember 
( 
g 
=>  "
g# $
.$ %
	Publisher% .
). /
./ 0
SetIsRequired0 =
(= >
true> B
)B C
;C D
map 
. 
	MapMember 
( 
g 
=>  "
g# $
.$ %
Description% 0
)0 1
.1 2
SetIsRequired2 ?
(? @
true@ D
)D E
;E F
map 
. 
	MapMember 
( 
g 
=>  "
g# $
.$ %
Price% *
)* +
.+ ,
SetIsRequired, 9
(9 :
true: >
)> ?
;? @
map 
. 
	MapMember 
( 
g 
=>  "
g# $
.$ %
ReleaseDate% 0
)0 1
.1 2
SetIsRequired2 ?
(? @
true@ D
)D E
;E F
} 
) 
; 
}   	
}!! 
}"" ‚
uC:\Users\jpedr\Workspace\Fiap\tech-challenges-fiap-pos-dotnet\FiapCloudGames.Infrastructure\Mappings\MongoMappings.cs
	namespace		 	
FiapCloudGames		
 
.		 
Infrastructure		 '
.		' (
Mappings		( 0
;		0 1
public 
static 
class 
MongoMappings !
{ 
public 

static 
void 
ConfigureMappings (
(( )
)) *
{ 
UserMapping 
. 
	Configure 
( 
) 
;  
GameMapping 
. 
	Configure 
( 
) 
;  
} 
} √5
sC:\Users\jpedr\Workspace\Fiap\tech-challenges-fiap-pos-dotnet\FiapCloudGames.Infrastructure\Mappings\UserMapping.cs
	namespace 	
FiapCloudGames
 
. 
Infrastructure '
.' (
Mappings( 0
;0 1
public		 
static		 
class		 
UserMapping		 
{

 
public 

static 
void 
	Configure  
(  !
)! "
{ 
if 

( 
! 
BsonClassMap 
.  
IsClassMapRegistered .
(. /
typeof/ 5
(5 6
User6 :
): ;
); <
)< =
{ 	
BsonClassMap 
. 
RegisterClassMap )
<) *
User* .
>. /
(/ 0
map0 3
=>4 6
{ 
map 
. 
AutoMap 
( 
) 
; 
map 
. 
MapIdMember 
(  
u  !
=>" $
u% &
.& '
Id' )
)) *
. 
SetSerializer !
(! "
new" %
GuidSerializer& 4
(4 5
GuidRepresentation5 G
.G H
StandardH P
)P Q
)Q R
;R S
map 
. 
	MapMember 
( 
u 
=>  "
u# $
.$ %
Name% )
)) *
.* +
SetIsRequired+ 8
(8 9
true9 =
)= >
;> ?
map 
. 
	MapMember 
( 
u 
=>  "
u# $
.$ %
Username% -
)- .
.. /
SetIsRequired/ <
(< =
true= A
)A B
;B C
map 
. 
	MapMember 
( 
u 
=>  "
u# $
.$ %
Email% *
)* +
.+ ,
SetIsRequired, 9
(9 :
true: >
)> ?
;? @
map 
. 
	MapMember 
( 
u 
=>  "
u# $
.$ %
PasswordHash% 1
)1 2
.2 3
SetIsRequired3 @
(@ A
trueA E
)E F
;F G
map 
. 
	MapMember 
( 
u 
=>  "
u# $
.$ %
BornDate% -
)- .
.. /
SetIsRequired/ <
(< =
true= A
)A B
;B C
map 
. 
	MapMember 
( 
u 
=>  "
u# $
.$ %
	CreatedAt% .
). /
./ 0
SetIsRequired0 =
(= >
true> B
)B C
;C D
map 
. 
	MapMember 
( 
u 
=>  "
u# $
.$ %
Role% )
)) *
.* +
SetIsRequired+ 8
(8 9
true9 =
)= >
;> ?
} 
) 
; 
}   	
if!! 

(!! 
!!! 
BsonClassMap!! 
.!!  
IsClassMapRegistered!! .
(!!. /
typeof!!/ 5
(!!5 6
Player!!6 <
)!!< =
)!!= >
)!!> ?
{"" 	
BsonClassMap## 
.## 
RegisterClassMap## )
<##) *
Player##* 0
>##0 1
(##1 2
map##2 5
=>##6 8
{$$ 
map%% 
.%% 
AutoMap%% 
(%% 
)%% 
;%% 
map'' 
.'' 
	MapMember'' 
('' 
p'' 
=>''  "
p''# $
.''$ %
Cpf''% (
)''( )
.'') *
SetIsRequired''* 7
(''7 8
true''8 <
)''< =
;''= >
map(( 
.(( 
	MapMember(( 
((( 
p(( 
=>((  "
p((# $
.(($ %
Library((% ,
)((, -
;((- .
map)) 
.)) 
	MapMember)) 
()) 
p)) 
=>))  "
p))# $
.))$ %
Cart))% )
)))) *
;))* +
map** 
.** 
	MapMember** 
(** 
p** 
=>**  "
p**# $
.**$ %
Wishlist**% -
)**- .
;**. /
map,, 
.,, 
SetDiscriminator,, $
(,,$ %
$str,,% -
),,- .
;,,. /
}-- 
)-- 
;-- 
}.. 	
if// 

(// 
!// 
BsonClassMap// 
.//  
IsClassMapRegistered// .
(//. /
typeof/// 5
(//5 6
	Publisher//6 ?
)//? @
)//@ A
)//A B
{00 	
BsonClassMap11 
.11 
RegisterClassMap11 )
<11) *
	Publisher11* 3
>113 4
(114 5
map115 8
=>119 ;
{22 
map33 
.33 
AutoMap33 
(33 
)33 
;33 
map55 
.55 
	MapMember55 
(55 
p55 
=>55  "
p55# $
.55$ %
PublisherName55% 2
)552 3
.553 4
SetIsRequired554 A
(55A B
true55B F
)55F G
;55G H
map66 
.66 
	MapMember66 
(66 
p66 
=>66  "
p66# $
.66$ %
Cnpj66% )
)66) *
.66* +
SetIsRequired66+ 8
(668 9
true669 =
)66= >
;66> ?
map77 
.77 
	MapMember77 
(77 
p77 
=>77  "
p77# $
.77$ %
CompanyName77% 0
)770 1
.771 2
SetIsRequired772 ?
(77? @
true77@ D
)77D E
;77E F
map88 
.88 
	MapMember88 
(88 
p88 
=>88  "
p88# $
.88$ %
GamesPublished88% 3
)883 4
;884 5
map99 
.99 
	MapMember99 
(99 
p99 
=>99  "
p99# $
.99$ %
TeamMembers99% 0
)990 1
;991 2
map;; 
.;; 
SetDiscriminator;; $
(;;$ %
$str;;% 0
);;0 1
;;;1 2
}<< 
)<< 
;<< 
}== 	
}>> 
}?? â
ÄC:\Users\jpedr\Workspace\Fiap\tech-challenges-fiap-pos-dotnet\FiapCloudGames.Infrastructure\Middleware\CorrelationIdMiddlware.cs
	namespace 	
FiapCloudGames
 
. 
Infrastructure '
.' (

Middleware( 2
;2 3
public 
class #
CorrelationIdMiddleware $
{ 
private 
const 
string 
CorrelationIdHeader ,
=- .
$str/ A
;A B
private 
readonly 
RequestDelegate $
_next% *
;* +
public

 
#
CorrelationIdMiddleware

 "
(

" #
RequestDelegate

# 2
next

3 7
)

7 8
{ 
_next 
= 
next 
; 
} 
public 

async 
Task 
Invoke 
( 
HttpContext (
context) 0
)0 1
{ 
var 
correlationId 
= 
context #
.# $
Request$ +
.+ ,
Headers, 3
[3 4
CorrelationIdHeader4 G
]G H
.H I
FirstOrDefaultI W
(W X
)X Y
;Y Z
if 

( 
string 
. 
IsNullOrEmpty  
(  !
correlationId! .
). /
)/ 0
correlationId 
= 
Guid  
.  !
NewGuid! (
(( )
)) *
.* +
ToString+ 3
(3 4
)4 5
;5 6
context 
. 
Items 
[ 
CorrelationIdHeader )
]) *
=+ ,
correlationId- :
;: ;
context 
. 
Response 
. 
Headers  
[  !
CorrelationIdHeader! 4
]4 5
=6 7
correlationId8 E
;E F
using 
( 

LogContext 
. 
PushProperty &
(& '
$str' 6
,6 7
correlationId8 E
)E F
)F G
{ 	
await 
_next 
( 
context 
)  
;  !
} 	
} 
} Í*
zC:\Users\jpedr\Workspace\Fiap\tech-challenges-fiap-pos-dotnet\FiapCloudGames.Infrastructure\Middleware\ExceptionHandler.cs
	namespace 	
FiapCloudGames
 
. 
Infrastructure '
.' (

Middleware( 2
;2 3
public

 
class

 
ExceptionHandler

 
{ 
private 
readonly 
RequestDelegate $
_next% *
;* +
private 
readonly 
ILogger 
< 
ExceptionHandler -
>- .
_logger/ 6
;6 7
public 

ExceptionHandler 
( 
RequestDelegate +
next, 0
,0 1
ILogger2 9
<9 :
ExceptionHandler: J
>J K
loggerL R
)R S
{ 
_next 
= 
next 
; 
_logger 
= 
logger 
; 
} 
public 

async 
Task 
InvokeAsync !
(! "
HttpContext" -
context. 5
)5 6
{ 
try 
{ 	
await 
_next 
( 
context 
)  
;  !
} 	
catch 
( 
MongoWriteException "
ex# %
)% &
when' +
(, -
ex- /
./ 0

WriteError0 :
.: ;
Category; C
==D F
ServerErrorCategoryG Z
.Z [
DuplicateKey[ g
)g h
{ 	
await  
HandleExceptionAsync &
(& '
context 
, 
ex 
, 
HttpStatusCode   
.   
Conflict   '
,  ' (
$str!! .
,!!. /
$str"" 
)## 
;## 
}$$ 	
catch%% 
(%% 
HttpException%% 
ex%% 
)%%  
{&& 	
await''  
HandleExceptionAsync'' &
(''& '
context(( 
,(( 
ex)) 
,)) 
(** 
HttpStatusCode** 
)**  
ex**  "
.**" #

StatusCode**# -
,**- .
ex++ 
.++ 
Message++ 
,++ 
ex,, 
.,, 
Error,, 
)-- 
;-- 
}.. 	
catch// 
(// 
	Exception// 
ex// 
)// 
{00 	
await11  
HandleExceptionAsync11 &
(11& '
context22 
,22 
ex33 
,33 
HttpStatusCode44 
.44 
InternalServerError44 2
,442 3
ex55 
.55 
Message55 
,55 
$str66 '
)77 
;77 
}88 	
}99 
private;; 
async;; 
Task;;  
HandleExceptionAsync;; +
(;;+ ,
HttpContext;;, 7
context;;8 ?
,;;? @
	Exception;;A J
ex;;K M
,;;M N
HttpStatusCode;;O ]

statusCode;;^ h
,;;h i
string;;j p
message;;q x
,;;x y
string	;;z Ä
error
;;Å Ü
)
;;Ü á
{<< 
context== 
.== 
Response== 
.== 

StatusCode== #
===$ %
(==& '
int==' *
)==* +

statusCode==+ 5
;==5 6
context>> 
.>> 
Response>> 
.>> 
ContentType>> $
=>>% &
$str>>' 9
;>>9 :
var@@ 
traceId@@ 
=@@ 
context@@ 
.@@ 
Items@@ #
[@@# $
$str@@$ 6
]@@6 7
?@@7 8
.@@8 9
ToString@@9 A
(@@A B
)@@B C
??@@D F
context@@G N
.@@N O
TraceIdentifier@@O ^
;@@^ _
varBB 
responseBB 
=BB 
newBB 
{CC 	
errorDD 
,DD 

statusCodeEE 
=EE 
(EE 
intEE 
)EE 

statusCodeEE (
,EE( )
messageFF 
,FF 
traceIdGG 
}HH 	
;HH	 

_loggerJJ 
.JJ 
LogErrorJJ 
(JJ 
exJJ 
,JJ 
$strJJ U
,JJU V
exJJW Y
.JJY Z
GetTypeJJZ a
(JJa b
)JJb c
.JJc d
NameJJd h
,JJh i
exJJj l
.JJl m
MessageJJm t
)JJt u
;JJu v
varLL 
optionsLL 
=LL 
newLL !
JsonSerializerOptionsLL /
{LL0 1 
PropertyNamingPolicyLL2 F
=LLG H
JsonNamingPolicyLLI Y
.LLY Z
	CamelCaseLLZ c
}LLd e
;LLe f
varMM 
jsonMM 
=MM 
JsonSerializerMM !
.MM! "
	SerializeMM" +
(MM+ ,
responseMM, 4
,MM4 5
optionsMM6 =
)MM= >
;MM> ?
awaitNN 
contextNN 
.NN 
ResponseNN 
.NN 

WriteAsyncNN )
(NN) *
jsonNN* .
)NN. /
;NN/ 0
}OO 
}PP Ω 
xC:\Users\jpedr\Workspace\Fiap\tech-challenges-fiap-pos-dotnet\FiapCloudGames.Infrastructure\Repository\GameRepository.cs
	namespace 	
FiapCloudGames
 
. 
Infrastructure '
.' (

Repository( 2
;2 3
public 
class 
GameRepository 
: 
IGameRepository -
{ 
private		 
readonly		 
IMongoCollection		 %
<		% &
Game		& *
>		* +
_collection		, 7
;		7 8
public 

GameRepository 
( 
IMongoDatabase (
database) 1
)1 2
{ 
_collection 
= 
database 
. 
GetCollection ,
<, -
Game- 1
>1 2
(2 3
$str3 :
): ;
;; <
} 
public 

async 
Task 
CreateAsync !
(! "
Game" &
game' +
)+ ,
{ 
await 
_collection 
. 
InsertOneAsync (
(( )
game) -
)- .
;. /
} 
public 

async 
Task 
< 
IEnumerable !
<! "
Game" &
>& '
>' (
GetAllAsync) 4
(4 5
)5 6
{ 
return 
await 
_collection  
.  !
Find! %
(% &
_& '
=>( *
true+ /
)/ 0
.0 1
ToListAsync1 <
(< =
)= >
;> ?
} 
public 

async 
Task 
< 
IEnumerable !
<! "
Game" &
>& '
>' ("
GetAllByPublisherAsync) ?
(? @
Guid@ D
publisherIdE P
)P Q
{ 
return 
await 
_collection  
.  !
Find! %
(% &
g& '
=>( *
g+ ,
., -
	Publisher- 6
==7 9
publisherId: E
)E F
.F G
ToListAsyncG R
(R S
)S T
;T U
} 
public 

async 
Task 
< 
Game 
> 
GetByIdAsync (
(( )
Guid) -
id. 0
)0 1
{   
return!! 
await!! 
_collection!!  
.!!  !
Find!!! %
(!!% &
g!!& '
=>!!( *
g!!+ ,
.!!, -
Id!!- /
==!!0 2
id!!3 5
)!!5 6
.!!6 7
FirstOrDefaultAsync!!7 J
(!!J K
)!!K L
;!!L M
}"" 
public$$ 

async$$ 
Task$$ 
<$$ 
IEnumerable$$ !
<$$! "
Game$$" &
>$$& '
>$$' (
GetByIdsAsync$$) 6
($$6 7
IEnumerable$$7 B
<$$B C
Guid$$C G
>$$G H
ids$$I L
)$$L M
{%% 
return&& 
await&& 
_collection&&  
.'' 
Find'' 
('' 
g'' 
=>'' 
ids'' 
.'' 
Contains'' #
(''# $
g''$ %
.''% &
Id''& (
)''( )
)'') *
.(( 
ToListAsync(( 
((( 
)(( 
;(( 
})) 
public++ 

async++ 
Task++ 
UpdateAsync++ !
(++! "
Game++" &
game++' +
)+++ ,
{,, 
await-- 
_collection-- 
.-- 
ReplaceOneAsync-- )
(--) *
g--* +
=>--, .
g--/ 0
.--0 1
Id--1 3
==--4 6
game--7 ;
.--; <
Id--< >
,--> ?
game--@ D
)--D E
;--E F
}.. 
}// ´3
xC:\Users\jpedr\Workspace\Fiap\tech-challenges-fiap-pos-dotnet\FiapCloudGames.Infrastructure\Repository\UserRepository.cs
	namespace 	
FiapCloudGames
 
. 
Infrastructure '
.' (

Repository( 2
;2 3
public 
class 
UserRepository 
: 
IUserRepository -
{ 
private		 
readonly		 
IMongoCollection		 %
<		% &
User		& *
>		* +
_collection		, 7
;		7 8
public 

UserRepository 
( 
IMongoDatabase (
database) 1
)1 2
{ 
_collection 
= 
database 
. 
GetCollection ,
<, -
User- 1
>1 2
(2 3
$str3 :
): ;
;; <
CreateIndexes 
( 
) 
; 
} 
private 
void 
CreateIndexes 
( 
)  
{ 
var 
	indexKeys 
= 
Builders  
<  !
User! %
>% &
.& '
	IndexKeys' 0
.0 1
	Ascending1 :
(: ;
u; <
=>= ?
u@ A
.A B
EmailB G
)G H
;H I
var 
indexOptions 
= 
new 
CreateIndexOptions 1
{2 3
Unique4 :
=; <
true= A
}B C
;C D
var 

indexModel 
= 
new 
CreateIndexModel -
<- .
User. 2
>2 3
(3 4
	indexKeys4 =
,= >
indexOptions? K
)K L
;L M
_collection 
. 
Indexes 
. 
	CreateOne %
(% &

indexModel& 0
)0 1
;1 2
} 
public 

async 
Task 
CreateAsync !
(! "
User" &
user' +
)+ ,
{ 
await 
_collection 
. 
InsertOneAsync (
(( )
user) -
)- .
;. /
} 
public 

async 
Task 
< 
User 
? 
> 
GetByEmailAsync ,
(, -
string- 3
email4 9
)9 :
{ 
return   
await   
_collection    
.    !
Find  ! %
(  % &
u  & '
=>  ( *
u  + ,
.  , -
Email  - 2
==  3 5
email  6 ;
)  ; <
.  < =
FirstOrDefaultAsync  = P
(  P Q
)  Q R
;  R S
}!! 
public## 

async## 
Task## 
<## 
User## 
?## 
>## 
GetByIdAsync## )
(##) *
Guid##* .
id##/ 1
)##1 2
{$$ 
return%% 
await%% 
_collection%%  
.%%  !
Find%%! %
(%%% &
u%%& '
=>%%( *
u%%+ ,
.%%, -
Id%%- /
==%%0 2
id%%3 5
)%%5 6
.%%6 7
FirstOrDefaultAsync%%7 J
(%%J K
)%%K L
;%%L M
}&& 
public(( 

async(( 
Task(( 
<(( 
IEnumerable(( !
<((! "
User((" &
>((& '
>((' (
GetAllAsync(() 4
(((4 5
)((5 6
{)) 
return** 
await** 
_collection**  
.**  !
Find**! %
(**% &
_**& '
=>**( *
true**+ /
)**/ 0
.**0 1
ToListAsync**1 <
(**< =
)**= >
;**> ?
}++ 
public-- 

async-- 
Task-- 
AddAsync-- 
(-- 
User-- #
user--$ (
)--( )
{.. 
await// 
_collection// 
.// 
InsertOneAsync// (
(//( )
user//) -
)//- .
;//. /
}00 
public22 

async22 
Task22 
UpdateAsync22 !
(22! "
User22" &
user22' +
)22+ ,
{33 
await44 
_collection44 
.44 
ReplaceOneAsync44 )
(44) *
u44* +
=>44, .
u44/ 0
.440 1
Id441 3
==444 6
user447 ;
.44; <
Id44< >
,44> ?
user44@ D
)44D E
;44E F
}55 
public77 

async77 
Task77 
DeleteAsync77 !
(77! "
Guid77" &
id77' )
)77) *
{88 
await99 
_collection99 
.99 
DeleteOneAsync99 (
(99( )
u99) *
=>99+ -
u99. /
.99/ 0
Id990 2
==993 5
id996 8
)998 9
;999 :
}:: 
public<< 

async<< 
Task<< 
<<< 
IEnumerable<< !
<<<! "
Player<<" (
><<( )
><<) *
GetPlayersAsync<<+ :
(<<: ;
)<<; <
{== 
return>> 
await>> 
_collection>>  
.>>  !
OfType>>! '
<>>' (
Player>>( .
>>>. /
(>>/ 0
)>>0 1
.>>1 2
Find>>2 6
(>>6 7
_>>7 8
=>>>9 ;
true>>< @
)>>@ A
.>>A B
ToListAsync>>B M
(>>M N
)>>N O
;>>O P
}?? 
publicAA 

asyncAA 
TaskAA 
<AA 
IEnumerableAA !
<AA! "
	PublisherAA" +
>AA+ ,
>AA, -
GetPublishersAsyncAA. @
(AA@ A
)AAA B
{BB 
returnCC 
awaitCC 
_collectionCC  
.CC  !
OfTypeCC! '
<CC' (
	PublisherCC( 1
>CC1 2
(CC2 3
)CC3 4
.CC4 5
FindCC5 9
(CC9 :
_CC: ;
=>CC< >
trueCC? C
)CCC D
.CCD E
ToListAsyncCCE P
(CCP Q
)CCQ R
;CCR S
}DD 
}EE 